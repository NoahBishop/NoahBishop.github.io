<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
		<title itemprop="name">
			
				USB redirection process | 
						うさぎの手帳
		</title>
		
			<link rel="shortcut icon" href="/images/favicon.ico">
			
				<meta http-equiv="x-dns-prefetch-control" content="on">
				<link rel="stylesheet"
					href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC"
					media="all">
				<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
				<link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
				<link rel="stylesheet" href="/css/lib.min.css" media="all">
				<link rel="stylesheet" href="/css/font.css" media="all">
				<link rel="stylesheet" href="/css/insight.css" media="all">
				<link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
				<link rel="stylesheet" href="/css/zoom.css" media="all">
				<link rel="stylesheet" type="text/css" href="/css/sharejs.css">
				<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
				<script>
					/*Initial Variables*/
					var mashiro_option = new Object();
					var mashiro_global = new Object();
					mashiro_option.NProgressON = true;
					/* 
					* 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
					* 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
					*/
					mashiro_option.email_domain = "";
					mashiro_option.email_name = "";
					mashiro_option.cookie_version_control = "";
					mashiro_option.qzone_autocomplete = false;
					mashiro_option.site_name = "桜荘そのうさぎ";
					mashiro_option.author_name = "うさぎ";
					mashiro_option.site_url = "https://morning.eu.org";
					mashiro_option.v_appId = "EAyicHJhXmxJNEeuhACVujd4-gzGzoHsz";
					mashiro_option.v_appKey = "09Tjj4It5DOhgboduuM40u7y";
					mashiro_option.mathjax = "0";
	//mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/";
	//mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

	// mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
	// mashiro_option.float_player_on = true;

					/*End of Initial Variables*/
				</script>
				<script type="text/javascript">
					var bg = "https://morning.eu.org/images/cover/(1).jpg.webp,https://morning.eu.org/images/cover/(2).jpg.webp,https://morning.eu.org/images/cover/(3).jpg.webp,https://morning.eu.org/images/cover/(4).jpg.webp".split(",");
					var bgindex = Math.floor(Math.random() * bg.length);
					if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
						alert('朋友，IE浏览器未适配哦~');
					}
				</script>
				<script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
				<script src='//unpkg.com/valine@1.3.9/dist/Valine.min.js'></script>
				<style type="text/css">
					.hljs-ln {
						border-collapse: collapse
					}

					.hljs-ln td {
						padding: 0
					}

					.hljs-ln-n:before {
						content: attr(data-line-number)
					}
				</style>
				<style type="text/css">
					.site-top .lower nav {
						display: block !important;
					}

					.author-profile i,
					.post-like a,
					.post-share .show-share,
					.sub-text,
					.we-info a,
					span.sitename,
					.post-more i:hover,
					#pagination a:hover,
					.post-content a:hover,
					.float-content i:hover {
						color: #FE9600
					}

					.feature i,
					.download,
					.navigator i:hover,
					.links ul li:before,
					.ar-time i,
					span.ar-circle,
					.object,
					.comment .comment-reply-link,
					.siren-checkbox-radio:checked+.siren-checkbox-radioInput:after {
						background: #FE9600
					}

					::-webkit-scrollbar-thumb {
						background: #FE9600
					}

					.download,
					.navigator i:hover,
					.link-title,
					.links ul li:hover,
					#pagination a:hover,
					.comment-respond input[type='submit']:hover {
						border-color: #FE9600
					}

					.entry-content a:hover,
					.site-info a:hover,
					.comment h4 a,
					#comments-navi a.prev,
					#comments-navi a.next,
					.comment h4 a:hover,
					.site-top ul li a:hover,
					.entry-title a:hover,
					#archives-temp h3,
					span.page-numbers.current,
					.sorry li a:hover,
					.site-title a:hover,
					i.iconfont.js-toggle-search.iconsearch:hover,
					.comment-respond input[type='submit']:hover {
						color: #FE9600
					}

					.comments .comments-main {
						display: block !important;
					}

					.comments .comments-hidden {
						display: none !important;
					}

					background-position:center center;
					background-attachment:inherit;
					}
				</style>
<meta name="generator" content="Hexo 5.4.2"></head>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a target="_blank" rel="noopener" href="https://morning.eu.org">
          <img src="https://morning.eu.org/images/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>
          Live your life with passion! With some drive!
        </p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="/images/other/next-b.svg">
          </li>
          
            
              
                  <li>
                    <a href="https://github.com/NoahBishop" target="_blank" class="social-github" title="github">
                      <img src="https://morning.eu.org/images/social/github.png">
                    </a>
                  </li>
                  
                    
              
                  <li>
                    <a href="https://t.me/mega1037" target="_blank" class="social-github" title="telegram">
                      <img src="https://morning.eu.org/images/social/telegram.png">
                    </a>
                  </li>
                  
                    
              
                  <li>
                    <a href="https://music.163.com/#/user/home?id=305378376" target="_blank" class="social-github" title="netease">
                      <img src="https://morning.eu.org/images/social/wangyiyun.png">
                    </a>
                  </li>
                  
                    
              
                  <li>
                    <a href="https://www.twitter.com/noah_bishop_z" target="_blank" class="social-github" title="twitter">
                      <img src="https://morning.eu.org/images/social/twitter.png">
                    </a>
                  </li>
                  
                    
              
                  <li>
                    <a href="mailto:beiloquuw@gamil.com" target="_blank" class="social-github" title="email">
                      <img src="https://morning.eu.org/images/social/email.svg">
                    </a>
                  </li>
                  
                    
                      
                        <li id="bg-next">
                          <img src="/images/other/next-b.svg">
                        </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">桜荘その</span>
            <span class="shironeko">うさぎ</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E7%94%9F%E6%B4%BB/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E8%B5%84%E6%BA%90/">
                          <i class="fa fa-cloud-download" aria-hidden="true"></i>
                          资源
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E9%9A%8F%E6%83%B3/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随想
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E8%BD%AC%E8%BD%BD/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          转载
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/tags/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-tag" aria-hidden="true"></i>
                    标签
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          主题
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url('/images/cover/usb.png');" src="" data-src="/images/cover/usb.png">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      USB redirection process</h1>
      <p class="entry-census">
        <span>
          <a href="morning.eu.org">
            <img src="/images/custom/avatar.jpg">
          </a>
        </span>
        <span>
          <a href="morning.eu.org">Noah</a>
        </span>
        <span class="bull">
        ·</span>
        2024-11-30<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h1 id="U盘重定向读取文件流程和分析"><a href="#U盘重定向读取文件流程和分析" class="headerlink" title="U盘重定向读取文件流程和分析"></a>U盘重定向读取文件流程和分析</h1><h2 id="U盘重定向读取文件流程"><a href="#U盘重定向读取文件流程" class="headerlink" title="U盘重定向读取文件流程"></a>U盘重定向读取文件流程</h2><p><img src="https://s2.loli.net/2026/01/11/ak8tcERXrJgSzG5.png" alt="U_disk.drawio.png"></p>
<p>U盘的重定向流程如上图所示：</p>
<ol>
<li>首先由服务端发送读取的控制指令，该指令只包含要读取逻辑块和长度信息，不做实际读取</li>
<li>之后物理机回复服务端，不包含内容。</li>
<li>服务端发送真读取的控制指令，读取上一次指定逻辑块和长度信息。（物理机执行耗时1.7ms）</li>
<li>物理机将读取的64kb数据发送到服务端。</li>
<li>服务端再次发送真读取的控制指令。</li>
<li>物理机回应已经读完无剩余的信息发送到服务端。</li>
</ol>
<h2 id="和物理机相比的耗时点"><a href="#和物理机相比的耗时点" class="headerlink" title="和物理机相比的耗时点"></a>和物理机相比的耗时点</h2><p>如上面所述的U盘的重定向流程，可以发现有大量的网络数据控制读取，整个一个64kb的块读取实际的读取耗时只有1.7~2ms附近，但数据控制包的收发延迟远大于实际的读取耗时，造成速度下降，假设延迟为<code>x</code>ms。</p>
<p>在上图中忽略虚拟机和物理机处理数据的时间，一个64kb的块读取交互的耗时约为<code>（6x+实际读取64kb的数据的时间）</code>，在ping值为17ms的情况下，延迟除2为8.5ms，此时读取的一个64kb的块的耗时必定大于50ms。可以发现大量的时间耗费在控制数据的传输中，导致速度变慢。</p>
<h1 id="USB-Camera-redirection-work-processing"><a href="#USB-Camera-redirection-work-processing" class="headerlink" title="USB Camera redirection work processing"></a>USB Camera redirection work processing</h1><h2 id="USB-redirection-protocol-data-packet-header"><a href="#USB-redirection-protocol-data-packet-header" class="headerlink" title="USB redirection protocol data packet header"></a>USB redirection protocol data packet header</h2><table>
<thead>
<tr>
<th>Data packet type</th>
<th>0x code format</th>
</tr>
</thead>
<tbody>
<tr>
<td>usb_redir_hello</td>
<td>0x00</td>
</tr>
<tr>
<td>usb_redir_device_connect</td>
<td>0x01</td>
</tr>
<tr>
<td>usb_redir_device_disconnect</td>
<td>0x02</td>
</tr>
<tr>
<td>usb_redir_reset</td>
<td>0x03</td>
</tr>
<tr>
<td>usb_redir_interface_info</td>
<td>0x04</td>
</tr>
<tr>
<td>usb_redir_ep_info</td>
<td>0x05</td>
</tr>
<tr>
<td>usb_redir_set_configuration</td>
<td>0x06</td>
</tr>
<tr>
<td>usb_redir_get_configuration</td>
<td>0x07</td>
</tr>
<tr>
<td>usb_redir_configuration_status</td>
<td>0x08</td>
</tr>
<tr>
<td>usb_redir_set_alt_setting</td>
<td>0x09</td>
</tr>
<tr>
<td>usb_redir_get_alt_setting</td>
<td>0x0A</td>
</tr>
<tr>
<td>usb_redir_alt_setting_status</td>
<td>0x0B</td>
</tr>
<tr>
<td>usb_redir_start_iso_stream</td>
<td>0x0C</td>
</tr>
<tr>
<td>usb_redir_stop_iso_stream</td>
<td>0x0D</td>
</tr>
<tr>
<td>usb_redir_iso_stream_status</td>
<td>0x0E</td>
</tr>
<tr>
<td>usb_redir_start_interrupt_receiving</td>
<td>0x0F</td>
</tr>
<tr>
<td>usb_redir_stop_interrupt_receiving</td>
<td>0x10</td>
</tr>
<tr>
<td>usb_redir_interrupt_receiving_status</td>
<td>0x11</td>
</tr>
<tr>
<td>usb_redir_alloc_bulk_streams</td>
<td>0x12</td>
</tr>
<tr>
<td>usb_redir_free_bulk_streams</td>
<td>0x13</td>
</tr>
<tr>
<td>usb_redir_bulk_streams_status</td>
<td>0x14</td>
</tr>
<tr>
<td>usb_redir_cancel_data_packet</td>
<td>0x15</td>
</tr>
<tr>
<td>usb_redir_filter_reject</td>
<td>0x16</td>
</tr>
<tr>
<td>usb_redir_filter_filter</td>
<td>0x17</td>
</tr>
<tr>
<td>usb_redir_device_disconnect_ack</td>
<td>0x18</td>
</tr>
<tr>
<td>usb_redir_start_bulk_receiving</td>
<td>0x19</td>
</tr>
<tr>
<td>usb_redir_stop_bulk_receiving</td>
<td>0x1A</td>
</tr>
<tr>
<td>usb_redir_bulk_receiving_status</td>
<td>0x1B</td>
</tr>
<tr>
<td>usb_redir_control_packet</td>
<td>0x64</td>
</tr>
<tr>
<td>usb_redir_bulk_packet</td>
<td>0x65</td>
</tr>
<tr>
<td>usb_redir_iso_packet</td>
<td>0x66</td>
</tr>
<tr>
<td>usb_redir_interrupt_packet</td>
<td>0x67</td>
</tr>
<tr>
<td>usb_redir_buffered_bulk_packet</td>
<td>0x68</td>
</tr>
</tbody>
</table>
<p>Display In Wireshark:<br><img src="https://s2.loli.net/2026/01/11/VNus1irKpvjD56o.jpg" alt="5.jpg"></p>
<p>Previous data show this packet is <code>usb_redir_device_connect</code> packet and append data length was 10(<code>0x0a</code>) bytes, append data was struct <code>usb_redir_device_connect_header</code>, there are basic information about redirection device. This is a <code>usb_redir_speed_full</code> device, <code>vendor_id</code> is <code>0x0c45</code> and <code>product_id</code> is <code>0x6366</code> etc.</p>
<pre><code class="c">enum &#123;
    usb_redir_speed_low,
    usb_redir_speed_full,
    usb_redir_speed_high,
    usb_redir_speed_super,
    usb_redir_speed_unknown = 255
&#125;

struct usb_redir_device_connect_header &#123;
    uint8_t speed;
    uint8_t device_class;
    uint8_t device_subclass;
    uint8_t device_protocol;
    uint16_t vendor_id;
    uint16_t product_id;
    uint16_t device_version_bcd;
&#125;
</code></pre>
<h2 id="USB-redirection-work-processing"><a href="#USB-redirection-work-processing" class="headerlink" title="USB redirection work processing"></a>USB redirection work processing</h2><pre><code class="c">// interface info 
struct usb_redir_interface_info_header &#123;
    uint32_t interface_count;
    uint8_t interface[32];
    uint8_t interface_class[32];
    uint8_t interface_subclass[32];
    uint8_t interface_protocol[32];
&#125;
// binary
05 00 00 00 
00 01 02 03 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
0e 0e 0e 01 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
01 02 02 01 02 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

// endpoint info
enum &#123;
    /* Note these 4 match the usb spec! */
    usb_redir_type_control,
    usb_redir_type_iso,
    usb_redir_type_bulk,
    usb_redir_type_interrupt,
    usb_redir_type_invalid = 255
&#125;

struct usb_redir_ep_info_header &#123;
    uint8_t type[32];
    uint8_t interval[32];
    uint8_t interface[32];
    uint16_t max_packet_size[32];
    uint32_t max_streams[32];
&#125;
// binary
00 ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff 00 ff ff 03 ff ff ff ff ff ff ff ff ff ff ff ff
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 06 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 10 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
</code></pre>
<p>When client receive usb redirection channel packet from server will call function <code>spice_usb_backend_read_guest_data</code> -&gt; <code>usbredirhost_read_guest_data</code> -&gt; <code>usbredirparser_do_read</code> -&gt; <code>usbredir_read_callback</code> <- -> <code>usbredirparser_call_type_func</code> . In function <code>usbredirparser_call_type_func</code> will call according function by data packet type.</p>
<p><img src="https://s2.loli.net/2026/01/11/FKn4cZSMReiuAvN.png" alt="network.png"></p>
<p>Previous image show the usb camera redirection whole process, to simple this process, It can be split to 3 part:</p>
<ol>
<li>Get general device descriptor (device descriptor, full configuration descriptor), this information tell host how to control this device.</li>
<li>Get camera special config for video capture, like Gama, brightness. etc.</li>
<li>Control device use Urb control.</li>
</ol>
<p>To control a device in usb redirection need use libusb function control transfer, the usb_redir_control_packet struct is</p>
<pre><code class="c">struct usb_redir_control_packet_header &#123;
    uint8_t endpoint;
    uint8_t request;
    uint8_t requesttype;
    uint8_t status;
    uint16_t value;
    uint16_t index;
    uint16_t length;
&#125;
</code></pre>
<h2 id="libusb-control-setup-Struct"><a href="#libusb-control-setup-Struct" class="headerlink" title="libusb_control_setup Struct"></a><strong>libusb_control_setup Struct</strong></h2><pre><code class="c">uint8_t  bmRequestType
uint8_t  bRequest
uint16_t  wValue
uint16_t  wIndex
uint16_t  wLength
</code></pre>
<h3 id="bmRequestType"><a href="#bmRequestType" class="headerlink" title="bmRequestType"></a>bmRequestType</h3><p>Bits 0:4 determine recipient, see <a target="_blank" rel="noopener" href="https://libusb.sourceforge.io/api-1.0/group__libusb__misc.html#ga20a4e8a729aa543fa742a5086596cbae">libusb_request_recipient</a>. Bits 5:6 determine type, see <a target="_blank" rel="noopener" href="https://libusb.sourceforge.io/api-1.0/group__libusb__misc.html#ga0b0933ae70744726cde11254c39fac91">libusb_request_type</a>. Bit 7 determines data transfer direction, see <a target="_blank" rel="noopener" href="https://libusb.sourceforge.io/api-1.0/group__libusb__desc.html#ga86c880af878493aa8f805c2aba654b8b">libusb_endpoint_direction</a>.</p>
<h4 id="libusb-endpoint-direction"><a href="#libusb-endpoint-direction" class="headerlink" title="libusb_endpoint_direction"></a>libusb_endpoint_direction</h4><table>
<thead>
<tr>
<th style="text-align:left">Enumerator</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">LIBUSB_ENDPOINT_OUT</td>
<td>Out: host-to-device.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_ENDPOINT_IN</td>
<td>In: device-to-host.</td>
</tr>
</tbody>
</table>
<h4 id="libusb-request-type"><a href="#libusb-request-type" class="headerlink" title="libusb_request_type"></a>libusb_request_type</h4><table>
<thead>
<tr>
<th style="text-align:left">Enumerator</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_TYPE_STANDARD</td>
<td>Standard.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_TYPE_CLASS</td>
<td>Class.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_TYPE_VENDOR</td>
<td>Vendor.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_TYPE_RESERVED</td>
<td>Reserved.</td>
</tr>
</tbody>
</table>
<h4 id="libusb-request-recipient"><a href="#libusb-request-recipient" class="headerlink" title="libusb_request_recipient"></a>libusb_request_recipient</h4><table>
<thead>
<tr>
<th style="text-align:left">Enumerator</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">LIBUSB_RECIPIENT_DEVICE</td>
<td>Device.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_RECIPIENT_INTERFACE</td>
<td>Interface.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_RECIPIENT_ENDPOINT</td>
<td>Endpoint.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_RECIPIENT_OTHER</td>
<td>Other.</td>
</tr>
</tbody>
</table>
<h3 id="bRequest"><a href="#bRequest" class="headerlink" title="bRequest"></a>bRequest</h3><p>If the type bits of bmRequestType are equal to <a target="_blank" rel="noopener" href="https://libusb.sourceforge.io/api-1.0/group__libusb__misc.html#gga0b0933ae70744726cde11254c39fac91a20eca62c34d2d25be7e1776510184209">LIBUSB_REQUEST_TYPE_STANDARD</a> then this field refers to <a target="_blank" rel="noopener" href="https://libusb.sourceforge.io/api-1.0/group__libusb__misc.html#ga5b5912057c2d7e23b3ed5aa0c20236df">libusb_standard_request</a>. For other cases, use of this field is application-specific.</p>
<h4 id="libusb-standard-request"><a href="#libusb-standard-request" class="headerlink" title="libusb_standard_request"></a>libusb_standard_request</h4><table>
<thead>
<tr>
<th style="text-align:left">Enumerator</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_GET_STATUS</td>
<td>Request status of the specific recipient.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_CLEAR_FEATURE</td>
<td>Clear or disable a specific feature.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_SET_FEATURE</td>
<td>Set or enable a specific feature.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_SET_ADDRESS</td>
<td>Set device address for all future accesses.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_GET_DESCRIPTOR</td>
<td>Get the specified descriptor.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_SET_DESCRIPTOR</td>
<td>Used to update existing descriptors or add new descriptors.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_GET_CONFIGURATION</td>
<td>Get the current device configuration value.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_SET_CONFIGURATION</td>
<td>Set device configuration.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_GET_INTERFACE</td>
<td>Return the selected alternate setting for the specified interface.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_SET_INTERFACE</td>
<td>Select an alternate interface for the specified interface.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_SYNCH_FRAME</td>
<td>Set then report an endpoint’s synchronization frame.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_REQUEST_SET_SEL</td>
<td>Sets both the U1 and U2 Exit Latency.</td>
</tr>
<tr>
<td style="text-align:left">LIBUSB_SET_ISOCH_DELAY</td>
<td>Delay from the time a host transmits a packet to the time it is received by the device.</td>
</tr>
</tbody>
</table>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://morning.eu.org/images/custom/donate/404.jpg"></li>
                <li class="wechat-code"><img src="https://morning.eu.org/images/custom/donate/404.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2024/11/30/USB/%E5%9F%BA%E7%A1%80%E6%8A%93%E5%8C%85%E7%9F%A5%E8%AF%86/" rel="prev">
              <div class="background">
                <img class="lazyload" src="" data-src="/images/cover/usb.png" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" src="/images/cover/usb.png">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                Basic packet capture</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2022/07/01/Qt/essay_01_use%20cmake%20settting%20up%20Qt%20project/" rel="next">
              <div class="background">
                <img class="lazyload" src="" data-src="/images/cover/QtWithTorch.webp" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" src="/images/cover/QtWithTorch.webp">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                Setting up Qt Projects with CMake and Linking External</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      



      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="morning.eu.org" class="profile gravatar"><img src="/images/custom/avatar.jpg" itemprop="image" alt="Noah" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="morning.eu.org" itemprop="url" rel="author">Noah</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i></p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://morning.eu.org/images/other/wordpress-rotating-ball-o.svg">
        <img src="https://morning.eu.org/images/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2019-2026
      </p>
    </div>
    <div class="footer-device">
      <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank"
            style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i
            class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a
            href="https://2heng.xin/" target="_blank"
            style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a
            href="https://www.hojun.cn/" target="_blank"
            style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo,
          Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div>
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script type="text/javascript">
  /* <![CDATA[ */
  if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
    var Poi = { "pjax": "1", "movies": { "url": "", "name": "", "live": "close" }, "windowheight": "fixed", "codelamp": "close", "ajaxurl": "", "order": "asc", "formpostion": "bottom" };
  } else {
    var Poi = { "pjax": "1", "movies": { "url": "", "name": "", "live": "open" }, "windowheight": "auto", "codelamp": "close", "ajaxurl": "", "order": "asc", "formpostion": "bottom" };
  }
  /* ]]> */

</script>
<script>
  $(document).ready(function () {
    if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
      if ($(".pattern-center").length > 0) { //有图的情况
        tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
        });
      } else {
        tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
        });
      }
      var offsetTop = $('.toc').offset().top - 95;
      window.onscroll = function () {
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
        if (scrollTop >= offsetTop) {
          $('.toc').addClass('toc-fixed');
        } else {
          $('.toc').removeClass('toc-fixed');
        }
      }
    }
  });
</script>
    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://morning.eu.org/images/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">桜荘そのうさぎ</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="https://github.com/NoahBishop" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://t.me/mega1037" class="fa fa-telegram" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
        <a href="https://mailto:beiloquuw@gamil.com" class="fa fa-google" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/%E6%8A%80%E6%9C%AF/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/%E7%94%9F%E6%B4%BB/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/%E8%B5%84%E6%BA%90/">
                  <i class="fa fa-cloud-download" aria-hidden="true"></i>
                  资源
                </a>
              </li>
            
              <li>
                <a href="/categories/%E9%9A%8F%E6%83%B3/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随想
                </a>
              </li>
            
              <li>
                <a href="/categories/%E8%BD%AC%E8%BD%BD/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  转载
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/tags/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-tag" aria-hidden="true"></i>
            标签
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  主题
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>