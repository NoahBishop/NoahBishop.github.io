<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
		<title itemprop="name">
			
				Setting up Qt Projects with CMake and Linking External | 
						„ÅÜ„Åï„Åé„ÅÆÊâãÂ∏≥
		</title>
		
			<link rel="shortcut icon" href="/images/favicon.ico">
			
				<meta http-equiv="x-dns-prefetch-control" content="on">
				<link rel="stylesheet"
					href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC"
					media="all">
				<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
				<link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
				<link rel="stylesheet" href="/css/lib.min.css" media="all">
				<link rel="stylesheet" href="/css/font.css" media="all">
				<link rel="stylesheet" href="/css/insight.css" media="all">
				<link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
				<link rel="stylesheet" href="/css/zoom.css" media="all">
				<link rel="stylesheet" type="text/css" href="/css/sharejs.css">
				<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
				<script>
					/*Initial Variables*/
					var mashiro_option = new Object();
					var mashiro_global = new Object();
					mashiro_option.NProgressON = true;
					/* 
					* ÈÇÆÁÆ±‰ø°ÊÅØ‰πãÁ±ªÁöÑ‰∏úË•øÂèØ‰ª•Â°´Âú®ËøôÈáåÔºåËøô‰∫õjsÂèòÈáèÂü∫Êú¨ÈÉΩ‰ΩúÁî®‰∫ésakura-app.js
					* ËøôÊ†∑ÁöÑËÆæÁΩÆ‰ªÖÊòØ‰∏∫‰∫ÜÊñπ‰æøÂú®Âü∫‰∫éPHPÂºÄÂèëÁöÑ‰∏ªÈ¢ò‰∏≠ËÆæÁΩÆjsÂèòÈáèÔºåÊó¢ÁÑ∂ÁßªÊ§çÂà∞‰∫ÜNode‰∏äÔºåÊàëÊÉ≥ÊàñËÆ∏ÂèØ‰ª•Á≤æÁÆÄËøô‰∏ÄÈÄªËæëÂêß
					*/
					mashiro_option.email_domain = "";
					mashiro_option.email_name = "";
					mashiro_option.cookie_version_control = "";
					mashiro_option.qzone_autocomplete = false;
					mashiro_option.site_name = "Ê°úËçò„Åù„ÅÆ„ÅÜ„Åï„Åé";
					mashiro_option.author_name = "„ÅÜ„Åï„Åé";
					mashiro_option.site_url = "https://morning.eu.org";
					mashiro_option.v_appId = "EAyicHJhXmxJNEeuhACVujd4-gzGzoHsz";
					mashiro_option.v_appKey = "09Tjj4It5DOhgboduuM40u7y";
					mashiro_option.mathjax = "0";
	//mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/";
	//mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

	// mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
	// mashiro_option.float_player_on = true;

					/*End of Initial Variables*/
				</script>
				<script type="text/javascript">
					var bg = "https://morning.eu.org/images/cover/(1).jpg.webp,https://morning.eu.org/images/cover/(2).jpg.webp,https://morning.eu.org/images/cover/(3).jpg.webp,https://morning.eu.org/images/cover/(4).jpg.webp".split(",");
					var bgindex = Math.floor(Math.random() * bg.length);
					if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
						alert('ÊúãÂèãÔºåIEÊµèËßàÂô®Êú™ÈÄÇÈÖçÂì¶~');
					}
				</script>
				<script src="//code.bdstatic.com/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
				<script src='//unpkg.com/valine@1.3.9/dist/Valine.min.js'></script>
				<style type="text/css">
					.hljs-ln {
						border-collapse: collapse
					}

					.hljs-ln td {
						padding: 0
					}

					.hljs-ln-n:before {
						content: attr(data-line-number)
					}
				</style>
				<style type="text/css">
					.site-top .lower nav {
						display: block !important;
					}

					.author-profile i,
					.post-like a,
					.post-share .show-share,
					.sub-text,
					.we-info a,
					span.sitename,
					.post-more i:hover,
					#pagination a:hover,
					.post-content a:hover,
					.float-content i:hover {
						color: #FE9600
					}

					.feature i,
					.download,
					.navigator i:hover,
					.links ul li:before,
					.ar-time i,
					span.ar-circle,
					.object,
					.comment .comment-reply-link,
					.siren-checkbox-radio:checked+.siren-checkbox-radioInput:after {
						background: #FE9600
					}

					::-webkit-scrollbar-thumb {
						background: #FE9600
					}

					.download,
					.navigator i:hover,
					.link-title,
					.links ul li:hover,
					#pagination a:hover,
					.comment-respond input[type='submit']:hover {
						border-color: #FE9600
					}

					.entry-content a:hover,
					.site-info a:hover,
					.comment h4 a,
					#comments-navi a.prev,
					#comments-navi a.next,
					.comment h4 a:hover,
					.site-top ul li a:hover,
					.entry-title a:hover,
					#archives-temp h3,
					span.page-numbers.current,
					.sorry li a:hover,
					.site-title a:hover,
					i.iconfont.js-toggle-search.iconsearch:hover,
					.comment-respond input[type='submit']:hover {
						color: #FE9600
					}

					.comments .comments-main {
						display: block !important;
					}

					.comments .comments-hidden {
						display: none !important;
					}

					background-position:center center;
					background-attachment:inherit;
					}
				</style>
<meta name="generator" content="Hexo 5.4.2"></head>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a target="_blank" rel="noopener" href="https://morning.eu.org">
          <img src="https://morning.eu.org/images/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>
          Live your life with passion! With some drive!
        </p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="/images/other/next-b.svg">
          </li>
          
            
              
                  <li>
                    <a href="https://github.com/NoahBishop" target="_blank" class="social-github" title="github">
                      <img src="https://morning.eu.org/images/social/github.png">
                    </a>
                  </li>
                  
                    
              
                  <li>
                    <a href="https://t.me/mega1037" target="_blank" class="social-github" title="telegram">
                      <img src="https://morning.eu.org/images/social/telegram.png">
                    </a>
                  </li>
                  
                    
              
                  <li>
                    <a href="https://music.163.com/#/user/home?id=305378376" target="_blank" class="social-github" title="netease">
                      <img src="https://morning.eu.org/images/social/wangyiyun.png">
                    </a>
                  </li>
                  
                    
              
                  <li>
                    <a href="https://www.twitter.com/noah_bishop_z" target="_blank" class="social-github" title="twitter">
                      <img src="https://morning.eu.org/images/social/twitter.png">
                    </a>
                  </li>
                  
                    
              
                  <li>
                    <a href="mailto:beiloquuw@gamil.com" target="_blank" class="social-github" title="email">
                      <img src="https://morning.eu.org/images/social/email.svg">
                    </a>
                  </li>
                  
                    
                      
                        <li id="bg-next">
                          <img src="/images/other/next-b.svg">
                        </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">Ê°úËçò„Åù„ÅÆ</span>
            <span class="shironeko">„ÅÜ„Åï„Åé</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    È¶ñÈ°µ
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    ÂΩíÊ°£
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          ÊäÄÊúØ
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E7%94%9F%E6%B4%BB/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          ÁîüÊ¥ª
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E8%B5%84%E6%BA%90/">
                          <i class="fa fa-cloud-download" aria-hidden="true"></i>
                          ËµÑÊ∫ê
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E9%9A%8F%E6%83%B3/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          ÈöèÊÉ≥
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E8%BD%AC%E8%BD%BD/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          ËΩ¨ËΩΩ
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/tags/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-tag" aria-hidden="true"></i>
                    Ê†áÁ≠æ
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    Ê∏ÖÂçï
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          Ê≠åÂçï
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    ÁïôË®ÄÊùø
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    Âèã‰∫∫Â∏ê
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    ÂÖ≥‰∫é
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          ÊàëÔºü
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          ‰∏ªÈ¢ò
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- ÊúâÈÖçÂõæÈªòËÆ§Ê∏≤ÊüìÁ¨¨‰∏ÄÂº† -->
    <div class="pattern-attachment-img lazyload" style="background-image: url('/images/cover/QtWithTorch.webp');" src="" data-src="/images/cover/QtWithTorch.webp">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      Setting up Qt Projects with CMake and Linking External</h1>
      <p class="entry-census">
        <span>
          <a href="morning.eu.org">
            <img src="/images/custom/avatar.jpg">
          </a>
        </span>
        <span>
          <a href="morning.eu.org">Noah</a>
        </span>
        <span class="bull">
        ¬∑</span>
        2022-7-1<span class="bull">
        ¬∑</span>
      <span id="busuanzi_value_page_pv"></span>Ê¨°ÈòÖËØª</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- Â•óÂµåÁõÆÂΩï‰ΩøÁî®Ôºà‰∏ªË¶Å‰∏∫‰∫ÜÊîØÊè¥ËØÑËÆ∫Ôºâ-->
        
        <div class="entry-content">
          <h1 id="Setting-up-Qt-Projects-with-CMake-and-Linking-External-Libraries"><a href="#Setting-up-Qt-Projects-with-CMake-and-Linking-External-Libraries" class="headerlink" title="Setting up Qt Projects with CMake and Linking External Libraries"></a>Setting up Qt Projects with CMake and Linking External Libraries</h1><p><em>In the past few days, I attempted to develop a Windows application that utilized the Qt libraries for the GUI portion and libtorch and OpenCV for core calculations. The project was managed using cmake and compiled using the MSVC compiler. However, during development, I encountered several issues. In this article, I will detail these problems and provide solutions to fix them.</em></p>
<h2 id="What-is-cmake-and-Qt-libtorch"><a href="#What-is-cmake-and-Qt-libtorch" class="headerlink" title="What is cmake and Qt, libtorch"></a>What is cmake and Qt, libtorch</h2><ol>
<li>CMake is an open-source build system generator that is used to manage the build process of software projects. It is a cross-platform tool that generates build files for various operating systems, including Windows, Linux, and macOS. CMake allows developers to write build scripts in a simple and portable way, which can be used to build and manage software projects of different sizes and complexities.</li>
<li>Qt is a cross-platform application development framework used for creating desktop, mobile, and embedded applications. One of the major advantages of Qt is its cross-platform support, allowing developers to create applications that can run on multiple operating systems such as Windows, Linux, macOS, and mobile platforms like Android and iOS. Qt also provides a rich set of GUI widgets and provides easy access to many platform-specific features.</li>
<li>Libtorch is a C++ library for PyTorch, an open-source machine learning framework. Libtorch allows developers to use PyTorch in C++ applications, enabling high-performance machine learning inference on CPUs and GPUs. Libtorch provides a simple and flexible API for loading and running PyTorch models in C++.(In next session I will show you how to export PyTorch model and load it in C++ code)</li>
<li>OpenCV (Open Source Computer Vision) is an open-source library of programming functions mainly aimed at real-time computer vision tasks, such as image processing, object detection, and machine learning. (In my project is just for load image)</li>
</ol>
<h2 id="Environment-needed"><a href="#Environment-needed" class="headerlink" title="Environment needed"></a>Environment needed</h2><ul>
<li>C++17 or higher</li>
<li>OpenCV 4.7.0 or higher</li>
<li>LibTorch 1.9.0 or higher</li>
<li>Qt 6.6.0 or higher</li>
<li>MSVC compiler (from VS2022 or higher) :hammer:</li>
</ul>
<h2 id="Export-model-from-PyTorch-and-Load-in-C-code"><a href="#Export-model-from-PyTorch-and-Load-in-C-code" class="headerlink" title="Export model from PyTorch and Load in C++ code"></a>Export model from PyTorch and Load in C++ code</h2><p>In python train model code:</p>
<pre><code class="python"># I use the res2next50 model as training model
model = timm.create_model(&#39;res2next50&#39;, pretrained=False)

# --------------- after trained ---------------

# first use a input 
image = Image.open(&quot;/kaggle/input/lung-and-colon-cancer-histopathological-images/lung_colon_image_set/lung_image_sets/lung_n/lungn1007.jpeg&quot;)

# make a prg image to tenser with size 1X3X224X224
image_tfm = transforms.Compose([
    transforms.Resize((224, 224)),
    transforms.ToTensor(),
])
img = image_tfm(image)
img = img[None, :]

# do a forward and export model
traced_script_module = torch.jit.trace(model, img)
traced_script_module.save(&quot;resnet_model.pt&quot;)
</code></pre>
<h2 id="Load-model-in-C-and-how-to-run-it"><a href="#Load-model-in-C-and-how-to-run-it" class="headerlink" title="Load model in C++ and how to run it"></a>Load model in C++ and how to run it</h2><pre><code class="c++">#include &lt;torch/script.h&gt;
#include &lt;opencv2/opencv.hpp&gt;

int main()&#123;
 // load module from enter path
    torch::jit::script::Module model;
    try &#123;
        // Deserialize the ScriptModule from a file using torch::jit::load().
        model = torch::jit::load(model_path);
        model.eval();
    &#125;
    catch (const c10::Error&amp; e) &#123;
        std::cerr &lt;&lt; &quot;error loading the model\n&quot;;
        std::cerr &lt;&lt; e.what();
    &#125;

    // input image
    cv::Mat image;
    try &#123;
        // Load image using OpenCV
        image = cv::imread(image_path);

        // Check if image was loaded successfully
        if (image.empty()) &#123;
            throw std::runtime_error(&quot;Failed to load image&quot;);
        &#125;

        // Convert BGR to RGB format
        cv::cvtColor(image, image, cv::COLOR_BGR2RGB);

        // resize to 224*224
        cv::resize(image, image, cv::Size(224, 224));
    &#125; catch (const std::exception&amp; e) &#123;
        std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
        return -1;
    &#125;

    // Create a vector of inputs.
    std::vector&lt;torch::jit::IValue&gt; inputs;

    // convert image to tenser
    auto tensor_image =
        torch::from_blob(image.data, &#123; image.rows, image.cols, 3 &#125;, torch::kByte)
            .permute(&#123; 2, 0, 1 &#125;);
    tensor_image = tensor_image.unsqueeze(0).to(torch::kFloat) / 255.0;

    // add tensor image to inputs
    inputs.push_back(tensor_image);

    // Execute the model and turn its output into a tensor.
    at::Tensor output = model.forward(inputs).toTensor();

    // softmax to tenser that make sum of tensor item equal to 1
    output = torch::softmax(output, 1);
&#125;
</code></pre>
<p>In previous code has <strong>three</strong>3Ô∏è‚É£ points must notice:</p>
<ol>
<li><p>If you download the libtorch <strong>release</strong> version, you must build your project as a release version. If you build your project as a <strong>debug</strong> version, the program will not work. The running error will be as follows:</p>
<pre><code class="c++">error loading the model
open file failed because of errno 42 on fopen: Illegal byte sequence, file path:
Exception raised from RAIIFile at C:\actions-runner\_work\pytorch\pytorch\builder\windows\pytorch\caffe2\serialize\file_adapter.cc:27 (most recent call first):
00007FFB4C58F66200007FFB4C58F600 c10.dll!c10::Error::Error [&lt;unknown file&gt; @ &lt;unknown line number&gt;]
00007FFB4C58F2AA00007FFB4C58F250 c10.dll!c10::detail::torchCheckFail [&lt;unknown file&gt; @ &lt;unknown line number&gt;]
00007FFAFA62FF4300007FFAFA62FE50 torch_cpu.dll!caffe2::serialize::FileAdapter::FileAdapter [&lt;unknown file&gt; @ &lt;unknown line number&gt;]
.
[ INFO:0@0.892] global plugin_loader.impl.hpp:67 cv::plugin::impl::DynamicLib::libraryLoad load D:\Qt_project\build-LCHIC-Desktop_Qt_6_6_0_MSVC2019_64bit-Debug\bin\calc_core\opencv_core_parallel_openmp470_64d.dll =&gt; FAILED
[ INFO:0@0.893] global plugin_loader.impl.hpp:67 cv::plugin::impl::DynamicLib::libraryLoad load opencv_core_parallel_openmp470_64d.dll =&gt; FAILED
Press &lt;RETURN&gt; to close this window...
</code></pre>
</li>
<li><p>In the previous C++ code, on line 29, I converted the image format from BGR to RGB. By default, OpenCV loads images in BGR mode (blue, green, red), whereas the <code>Image.open</code> function in Python training code loads images in RGB format.</p>
</li>
<li><p>In the previous C++ code, on line 54, I got the output for all probabilities. How can I get one specific probability and convert it to a C++ type (e.g., <code>int</code>, <code>float</code>, etc.)? The output size is 1xN.</p>
<pre><code class="C++">// get index 0 probability
float pro = output[0][0].item&lt;float&gt;();

// get the max probability idx
int max_pro_idx = torch::argmax(output).item&lt;int&gt;();
</code></pre>
</li>
</ol>
<h2 id="create-shared-library-in-windows"><a href="#create-shared-library-in-windows" class="headerlink" title="create shared library in windows"></a>create shared library in windows</h2><p>In my project, I used the Qt libraries for the GUI portion and the libtorch and OpenCV libraries for the core calculations. Therefore, I want to create a shared library called <code>model</code> that links the PyTorch and OpenCV libraries together.</p>
<pre><code class="cmake"># import libtorch
set(CMAKE_PREFIX_PATH &quot;replease to your libtorch installed folderüìÇ&quot;)
find_package(Torch REQUIRED)
set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; $&#123;TORCH_CXX_FLAGS&#125;&quot;)


# import opencv this need installed opencv and add environment path 
find_package(OpenCV REQUIRED)
include_directories( $&#123;OpenCV_INCLUDE_DIRS&#125; )


# create shared libary model and link need lib
add_library(model SHARED model.cpp)
target_include_directories(model INTERFACE
    &quot;$&lt;BUILD_INTERFACE:$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include&gt;&quot;
    &quot;$&lt;INSTALL_INTERFACE:$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;&gt;&quot;
)

set_target_properties(model PROPERTIES
    PUBLIC_HEADER include/model.h
    POSITION_INDEPENDENT_CODE 1
)

target_link_libraries(model PUBLIC &quot;$&#123;TORCH_LIBRARIES&#125;&quot; &quot;$&#123;OpenCV_LIBS&#125;&quot;)


# cpoy linked dll lib to build folder
if (MSVC)
    add_custom_command(TARGET model POST_BUILD
        COMMAND $&#123;CMAKE_COMMAND&#125; -E copy_if_different $&lt;TARGET_RUNTIME_DLLS:model&gt; $&lt;TARGET_FILE_DIR:model&gt;
        COMMAND_EXPAND_LISTS
    )
    file(GLOB TORCH_DLLS &quot;$&#123;TORCH_INSTALL_PREFIX&#125;/lib/*.dll&quot;)
    add_custom_command(TARGET model
                       POST_BUILD
                       COMMAND $&#123;CMAKE_COMMAND&#125; -E copy_if_different
                       $&#123;TORCH_DLLS&#125;
                       $&lt;TARGET_FILE_DIR:model&gt;)
endif (MSVC)

# call install scrpit in build folder with
# cmake --install ./
# install scrpit, install all lib
install(TARGETS model
    LIBRARY DESTINATION $&#123;CMAKE_INSTALL_LIBDIR&#125;
)

install(DIRECTORY $&lt;TARGET_FILE_DIR:model&gt;/ DESTINATION bin
    FILES_MATCHING PATTERN &quot;*.dll&quot;
    PATTERN &quot;CMakeFiles&quot; EXCLUDE
)
</code></pre>
<p>But when I link to this shared library In GUI portion and build my project:</p>
<pre><code class="cmake">target_link_libraries(myexe PRIVATE
    Qt$&#123;QT_VERSION_MAJOR&#125;::Widgets
    model
)
</code></pre>
<p>The error occurred, the cmake tell me cannot found <code>model.lib</code>. This error can be fixed by add this to you cmake project:</p>
<pre><code class="cmake"># use make cmake in windows can create shared libary with msvc
set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS 1)
</code></pre>
<h2 id="Qt-portion-issues"><a href="#Qt-portion-issues" class="headerlink" title="Qt portion issues"></a>Qt portion issues</h2><p>After successfully creating the shared library and including the header file, I encountered a new issue where the compiler reported many errors in the libtorch library header files. It was quite frustrating! After searching for similar issues, I discovered that the issue was caused by QT slots. To fix this issue, I needed to include the header file as follows:</p>
<pre><code class="c++">#undef slots

#include &lt;model.h&gt;

#define slots Q_SLOTS
</code></pre>
<h2 id="Package-your-application-and-make-installer"><a href="#Package-your-application-and-make-installer" class="headerlink" title="Package your application and make installer"></a>Package your application and make installer</h2><p>After finishing the project, the next step is to package it along with the necessary environment. My project uses Qt, libtorch, and OpenCV, and there are several ways to achieve this, my way is as follows:</p>
<p>First, I copied the necessary environment libraries to the build folderüìÇ</p>
<pre><code class="cmake"># cpoy linked dll lib to build folder
if (MSVC)
    add_custom_command(TARGET model POST_BUILD
        COMMAND $&#123;CMAKE_COMMAND&#125; -E copy_if_different $&lt;TARGET_RUNTIME_DLLS:model&gt; $&lt;TARGET_FILE_DIR:model&gt;
        COMMAND_EXPAND_LISTS
    )
    file(GLOB TORCH_DLLS &quot;$&#123;TORCH_INSTALL_PREFIX&#125;/lib/*.dll&quot;)
    add_custom_command(TARGET model
                       POST_BUILD
                       COMMAND $&#123;CMAKE_COMMAND&#125; -E copy_if_different
                       $&#123;TORCH_DLLS&#125;
                       $&lt;TARGET_FILE_DIR:model&gt;)
endif (MSVC)
</code></pre>
<p>Second, I used a CMake install script to install them.</p>
<pre><code class="cmake"># install scrpit, install all lib and model
install(TARGETS model
    LIBRARY DESTINATION $&#123;CMAKE_INSTALL_LIBDIR&#125;
)

install(DIRECTORY $&lt;TARGET_FILE_DIR:model&gt;/ DESTINATION bin
    FILES_MATCHING PATTERN &quot;*.dll&quot;
    PATTERN &quot;CMakeFiles&quot; EXCLUDE
)

install(FILES &quot;$&#123;PROJECT_SOURCE_DIR&#125;/model/resnet_model.pt&quot;
    DESTINATION bin/model
)

install(DIRECTORY &quot;$&#123;PROJECT_SOURCE_DIR&#125;/dataset/&quot;
    DESTINATION bin/dataset
)
</code></pre>
<p>The Qt portion may be more difficult, but fortunately, Qt provides a CMake script that we can use to automatically call <code>windeployqt.exe</code> when running the CMake install script.</p>
<pre><code class="cmake"># The command is defined in the Core component of the Qt6 package
find_package(Qt6 REQUIRED COMPONENTS Core)
qt_standard_project_setup()

qt_generate_deploy_app_script(
    TARGET LCHIC
    OUTPUT_SCRIPT deploy_script
    NO_UNSUPPORTED_PLATFORM_ERROR
)

install(SCRIPT $&#123;deploy_script&#125;)
</code></pre>
<p>After completing the above steps, I ran the command prompt as an administrator and changed the directory to the project build folder. Then, I ran <code>cmake --install ./</code> command. By default, the program and the necessary libraries will be installed in <code>C:/Program Files (x86)/your_project_name</code>.</p>
<p>The next step is to package an installer, and Inno Setup could be a good choice. It provides a good GUI that makes it easy to create your application installer. If you want the user to not see the publisher as ‚ÄòUnknown‚Äô when they install the application, you also need digital signing certificates and configure the signing tool. However, it is not free now.</p>
<h2 id="My-project-structure"><a href="#My-project-structure" class="headerlink" title="My project structure"></a>My project structure</h2><pre><code class="apl">D:\QT_PROJECT\LCHIC
|   CMakeLists.txt
|   CMakeLists.txt.user
|
+---dataset
|       lungaca1007.jpeg
|       lungn1007.jpeg
|       lungscc1007.jpeg
|
+---model
|       resnet_model.pt
|
+---src
|   |   CMakeLists.txt
|   |
|   +---calc_core
|   |   |   CMakeLists.txt
|   |   |   model.cpp
|   |   |
|   |   \---include
|   |           model.h
|   |
|   \---gui
|       |   CMakeLists.txt
|       |   main.cpp
|       |   mainwindow.cpp
|       |   mainwindow.h
|       |   mainwindow.ui
|       |
|       \---res
|               app_win32.rc
|               favicon.ico
|
\---test
        CMakeLists.txt
        test_core.cpp
</code></pre>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">Ëµè
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://morning.eu.org/images/custom/donate/404.jpg"></li>
                <li class="wechat-code"><img src="https://morning.eu.org/images/custom/donate/404.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> Áü•ËØÜÂÖ±‰∫´ÁΩ≤Âêç-ÈùûÂïÜ‰∏öÊÄß‰ΩøÁî®-Áõ∏ÂêåÊñπÂºèÂÖ±‰∫´ 4.0 ÂõΩÈôÖËÆ∏ÂèØÂçèËÆÆ</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
        
          
            <div class="post-nepre full next">
          
            <a href="/2021/12/12/Cpp%20primer/Cpp_c12/" rel="next">
              <div class="background">
                <img class="lazyload" src="" data-src="/images/cover/C_background.webp" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" src="/images/cover/C_background.webp">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                (ch12) Templates and Generic Programming (Not completed yet)</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      



      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="morning.eu.org" class="profile gravatar"><img src="/images/custom/avatar.jpg" itemprop="image" alt="Noah" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="morning.eu.org" itemprop="url" rel="author">Noah</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>life is perfact</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="ËØ∑ËæìÂÖ•ÂÖ≥ÈîÆËØç..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'ÊñáÁ´†',
            // PAGES: 'È°µÈù¢',
            CATEGORIES: 'ÂàÜÁ±ª',
            TAGS: 'Ê†áÁ≠æ',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://morning.eu.org/images/other/wordpress-rotating-ball-o.svg">
        <img src="https://morning.eu.org/images/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2019-2026
      </p>
    </div>
    <div class="footer-device">
      <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank"
            style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i
            class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a
            href="https://2heng.xin/" target="_blank"
            style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a
            href="https://www.hojun.cn/" target="_blank"
            style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo,
          Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div>
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="/js/botui.js"></script>
<!-- ‰∏çËíúÂ≠ê ÁΩëÈ°µËÆ°Êï∞Âô® -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script type="text/javascript">
  /* <![CDATA[ */
  if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
    var Poi = { "pjax": "1", "movies": { "url": "", "name": "", "live": "close" }, "windowheight": "fixed", "codelamp": "close", "ajaxurl": "", "order": "asc", "formpostion": "bottom" };
  } else {
    var Poi = { "pjax": "1", "movies": { "url": "", "name": "", "live": "open" }, "windowheight": "auto", "codelamp": "close", "ajaxurl": "", "order": "asc", "formpostion": "bottom" };
  }
  /* ]]> */

</script>
<script>
  $(document).ready(function () {
    if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
      if ($(".pattern-center").length > 0) { //ÊúâÂõæÁöÑÊÉÖÂÜµ
        tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // ÊîæÁΩÆÁõÆÂΩïÁöÑÂÆπÂô®
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // Ê≠£ÊñáÂÜÖÂÆπÊâÄÂú®
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // ÈúÄË¶ÅÁ¥¢ÂºïÁöÑÊ†áÈ¢òÁ∫ßÂà´
          headingsOffset: -400,
          scrollSmoothOffset: -85
        });
      } else {
        tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // ÊîæÁΩÆÁõÆÂΩïÁöÑÂÆπÂô®
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // Ê≠£ÊñáÂÜÖÂÆπÊâÄÂú®
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // ÈúÄË¶ÅÁ¥¢ÂºïÁöÑÊ†áÈ¢òÁ∫ßÂà´
          headingsOffset: -85,
          scrollSmoothOffset: -85
        });
      }
      var offsetTop = $('.toc').offset().top - 95;
      window.onscroll = function () {
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
        if (scrollTop >= offsetTop) {
          $('.toc').addClass('toc-fixed');
        } else {
          $('.toc').removeClass('toc-fixed');
        }
      }
    }
  });
</script>
    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://morning.eu.org/images/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">Ê°úËçò„Åù„ÅÆ„ÅÜ„Åï„Åé</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="https://github.com/NoahBishop" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://t.me/mega1037" class="fa fa-telegram" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
        <a href="https://mailto:beiloquuw@gamil.com" class="fa fa-google" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            È¶ñÈ°µ
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            ÂΩíÊ°£
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/%E6%8A%80%E6%9C%AF/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  ÊäÄÊúØ
                </a>
              </li>
            
              <li>
                <a href="/categories/%E7%94%9F%E6%B4%BB/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  ÁîüÊ¥ª
                </a>
              </li>
            
              <li>
                <a href="/categories/%E8%B5%84%E6%BA%90/">
                  <i class="fa fa-cloud-download" aria-hidden="true"></i>
                  ËµÑÊ∫ê
                </a>
              </li>
            
              <li>
                <a href="/categories/%E9%9A%8F%E6%83%B3/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  ÈöèÊÉ≥
                </a>
              </li>
            
              <li>
                <a href="/categories/%E8%BD%AC%E8%BD%BD/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  ËΩ¨ËΩΩ
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/tags/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-tag" aria-hidden="true"></i>
            Ê†áÁ≠æ
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            Ê∏ÖÂçï
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  Ê≠åÂçï
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            ÁïôË®ÄÊùø
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            Âèã‰∫∫Â∏ê
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            ÂÖ≥‰∫é
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  ÊàëÔºü
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  ‰∏ªÈ¢ò
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>